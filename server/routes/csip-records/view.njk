{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "moj/components/page-header-actions/macro.njk" import mojPageHeaderActions %}
{%- from "moj/components/sub-navigation/macro.njk" import mojSubNavigation -%}
{% from "govuk/components/notification-banner/macro.njk" import govukNotificationBanner %}

{% set fullWidth = true %}

{% set pageTitle = "Update a CSIP referral" if isUpdate else "CSIP record - CSIP" %}
{% extends "partials/layout.njk" %}

{% if actionButton %}
  {% set actionButtonHtml %}
    <form method="post" action="/csip-records/{{ recordUuid }}">
      <input type="hidden" name="_csrf" value="{{ csrfToken }}"/>
      <input type="hidden" name="action" value="{{ actionButton.action }}"/>
      {{ govukButton({
        text: actionButton.label,
        preventDoubleClick: true,
        classes: 'govuk-body govuk-!-margin-bottom-0'
      }) }}
    </form>
  {% endset %}
{% endif %}

{% set basePageHeader = 'CSIP referral for ' + (prisoner | firstNameSpaceLastName) %}

{% block pageHeader %}
  {% if successMessage %}
    {{ govukNotificationBanner({
      text: successMessage,
      type: "success"
    }) }}
  {% endif %}

  {{ mojPageHeaderActions({
    classes: 'govuk-!-margin-bottom-3',
    heading: {
      text: 'Update ' + basePageHeader if isUpdate else basePageHeader,
      classes: 'govuk-heading-xl'
    },
    items: [{
      html: actionButtonHtml,
      classes: 'govuk-!-display-none'
    }] if actionButton else []
  }) }}
  <hr class="govuk-section-break govuk-section-break--visible">
{% endblock %}

{% block innerContent %}
  {% if shouldShowTabs %}
    {{ mojSubNavigation({
      label: 'Sub navigation',
      items: [{
        text: 'Investigation',
        href: 'investigation',
        active: referralTabSelected == false
      }, {
        text: 'Referral',
        href: 'referral',
        active: referralTabSelected == true
      }]
    }) }}
  {% endif %}

  

  {% if referralTabSelected %}
    {% if screening %}
      {% include './components/screening.njk' %}
    {% endif %}

    {% include './components/referral.njk' %}
  {% else %}
    {% if decision %}
      {% include './components/decision.njk' %}
      <hr class="govuk-section-break govuk-section-break--visible govuk-section-break--xl">
    {% endif %}
    {% include './components/investigation.njk' %}
  {% endif %}

  <form method="post" action="/csip-records/{{ recordUuid }}">
  <input type="hidden" name="_csrf" value="{{ csrfToken }}"/>
  <input type="hidden" name="action" value="{{ actionButton.action }}"/>
  <div class="govuk-button-group">
    {% if actionButton %}
      {{ govukButton({
        text: actionButton.label,
        preventDoubleClick: true,
        classes: 'govuk-body govuk-!-margin-bottom-0'
      }) }}
    {% endif %}
    {% if secondaryButton %}
      <a class="govuk-link govuk-body" href="{{ secondaryButton.link }}">{{ secondaryButton.label }}</a>
    {% endif %}
  </div>
  </form>
{% endblock %}